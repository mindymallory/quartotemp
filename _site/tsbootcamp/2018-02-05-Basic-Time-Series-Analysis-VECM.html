<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>quarto-test-website - Basic Time-Series Analysis: A Drunk and Her Dog Explain Cointegration and the VECM Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">quarto-test-website</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../tsbootcamp.html">
 <span class="menu-text">Time Series Bootcamp</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#vector-error-correction-model" id="toc-vector-error-correction-model" class="nav-link active" data-scroll-target="#vector-error-correction-model">Vector Error Correction Model</a>
  <ul class="collapse">
  <li><a href="#the-johansen-test-for-cointegration" id="toc-the-johansen-test-for-cointegration" class="nav-link" data-scroll-target="#the-johansen-test-for-cointegration">The Johansen Test for Cointegration</a></li>
  <li><a href="#apply-the-johansen-test" id="toc-apply-the-johansen-test" class="nav-link" data-scroll-target="#apply-the-johansen-test">Apply the Johansen Test</a></li>
  <li><a href="#fit-the-vecm" id="toc-fit-the-vecm" class="nav-link" data-scroll-target="#fit-the-vecm">Fit the VECM</a></li>
  <li><a href="#what-does-this-tell-you" id="toc-what-does-this-tell-you" class="nav-link" data-scroll-target="#what-does-this-tell-you">What does this tell you?</a></li>
  <li><a href="#granger-causality-on-cointegrated-series" id="toc-granger-causality-on-cointegrated-series" class="nav-link" data-scroll-target="#granger-causality-on-cointegrated-series">Granger Causality on Cointegrated Series</a></li>
  </ul></li>
  <li><a href="#thats-it" id="toc-thats-it" class="nav-link" data-scroll-target="#thats-it">That’s It!</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Basic Time-Series Analysis: A Drunk and Her Dog Explain Cointegration and the VECM Model</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<p><em>This post is the fifth in a series explaining <a href="http://blog.mindymallory.com/2018/01/basic-time-series-analysis-the-game/">Basic Time Series Analysis</a>. Click the link to check out the first post which focused on stationarity versus non-stationarity, and to find a list of other topics covered. As a reminder, this post is intended to be a very applied example of how use certain tests and models in a time-sereis analysis, either to get someone started learning about time-series techniques or to provide a big-picture perspective to someone taking a formal time-series class where the stats are coming fast and furious. As in the first post, the code producing these examples is provided for those who want to follow along in R. If you aren’t into R, just ignore the code blocks and the intuition will follow.</em></p>
<p>My colleague <a href="https://twitter.com/TKuethe">@TKuethe</a> showed me this awesome old paper by Michael Murray, <a href="http://www.tandfonline.com/doi/abs/10.1080/00031305.1994.10476017">A Drunk and Her Dog: An Illusration of Cointegration and Error Correction</a>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Then I found this extension by Aaron Smith and Robin Harrison, <a href="https://pdfs.semanticscholar.org/2ab1/0ac4252f50f9f0b7b6f22a1b5c7655c6eb40.pdf">A Drunk, Her Dog, and Boyfiend: An Illusration of Multiple Cointegration and Error Correction</a>. The premise of both these papers is that if you follow a drunk out of the bar after a night of drinking, you will observe that her path looks much like a <em>random walk</em>. Also, if you have ever watched a dog freely exploring, it’s path also looks much like a random walk. The dog will go this way and that, wherever it’s nose leads it. If additionally, the dog belongs to the drunk, and the drunk calls periodically for the dog, the dog will stay pretty close to the drunk. So the drunk and her dog go forth wandering aimlessly, together.</p>
<p>This is exactly concept of cointegration, two (or more) series wandering aimlessly, together.</p>
<p>In this blog post we cover cointeration and most common model for cointegrated time-series, the Vector Error Correction Model (VECM). The most intuitive cases (besides the drunk and her dog) are markets that are related by a production process, like the soybean complex. Soybean crushers buy soybeans and sell meal and oil. Economic theory would suggest the prices of those three commodities to maintain a relationship so that the profitability of soybean crushers trends around some modest number greater than zero. If there were persistently high profits in the soybean crushing business, more soybean crushing capacity would be built, driving soybean prices higher and meal and oil prices lower from the increased demand (for soybeans) and supply (of meal and oil).</p>
<p>This can also come up in the stock market, especially if two companies are destined for similar fates. If you’ve ever read a trading book, trading this situation is sometimes called pairs trading. In commodities, it’s sometimes called spread trading. The idea is you look for two stocks (or commodity contracts) that are cointegrated (usually move together). Then you wait for a day when one goes up and one goes down. You bet that because they are cointegrated this deviation won’t last long, so you sell the one whose price went up and buy the one whose price went down. Then, no matter if the prices go up or down generally, as long as the two prices come back in line, you can make money.</p>
<p>In explaining the model, I couldn’t avoid using linear algebra this time, since the Johansen test itself calculates the determinant of a matrix.</p>
<p>We will go through specific examples of statistical tests for cointegration and some of the insights you can gain from fitting a VECM model of cointegrated series.</p>
<p>In this example we will use SPY (the S&amp;P 500 exchange traded fund) and SHY (iShares 1-3 year Treasury Bond) prices. We don’t use Goldman Sachs prices in this example (in contrast to the previous posts in this series) because it turns out SPY and GS are not cointegrated, so I found a different example that is.</p>
<div class="cell" data-hash="2018-02-05-Basic-Time-Series-Analysis-VECM_cache/html/unnamed-chunk-2_83f45faf5b33d80b67db1835dd95d708">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If you are following along, uncomment the next lines and run once to install the required packages </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages('ggplot2')</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages('xts')</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages('quantmod')</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages('broom')</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages('tseries')</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("kableExtra")</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("knitr")</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("vars")</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("urca")</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantmod)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">getSymbols</span>(<span class="fu">c</span>(<span class="st">'SPY'</span>, <span class="st">'SHY'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SPY" "SHY"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>SPY                <span class="ot">&lt;-</span> SPY<span class="sc">$</span>SPY.Adjusted</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>SHY                 <span class="ot">&lt;-</span> SHY<span class="sc">$</span>SHY.Adjusted</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>time_series           <span class="ot">&lt;-</span> <span class="fu">cbind</span>(SPY, SHY)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(time_series) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'SPY'</span>, <span class="st">'SHY'</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="vector-error-correction-model" class="level1">
<h1>Vector Error Correction Model</h1>
<p>A VECM model adds a term(s) to the VAR model we learned in the last post. At a minimum it adds an <span class="math inline">\(\alpha_i (\beta_0 + \beta_1 SPY_{t-1} + \beta_2 SHY_{t-1})\)</span> term to each equation. There could be more than one (but less than the number of equations you are modeling) of these new terms. Written out, the VECM model looks like this.</p>
<p><span class="math display">\[\begin{align}
\Delta SPY_t &amp;= \gamma^{spy}_0 + \alpha_1 (\beta_0 + \beta_1 SPY_{t-1} + \beta_2 SHY_{t-1}) + \gamma^{spy}_1 \Delta SPY_{t-1} + \gamma^{spy}_2 \Delta SPY_{t-2} + \gamma^{spy}_3 \Delta SHY_{t-1} + \gamma^{spy}_4 \Delta SHY_{t-2} + \nu^{spy}_t \\
\Delta SHY_t  &amp;= \gamma^{SHY}_0  + \alpha_2 (\beta_0 + \beta_1 SPY_{t-1} + \beta_2 SHY_{t-1}) + \gamma^{SHY}_1 \Delta SPY_{t-1}  + \gamma^{SHY}_2 \Delta SPY_{t-2}  + \gamma^{SHY}_3 \Delta SHY_{t-1}  + \gamma^{SHY}_4 \Delta SHY_{t-2}  + \nu^{SHY}_t
\end{align}\]</span></p>
<p>The <span class="math inline">\(\gamma\)</span>’s are regression coefficients on the lagged SPY and SHY returns, just like the <span class="math inline">\(\beta\)</span>’s from our VAR blog post. The <span class="math inline">\(\alpha_1 (\beta_0 + \beta_1 SPY_{t-1} + \beta_2 SHY_{t-1})\)</span>, and <span class="math inline">\(\alpha_2 (\beta_0 + \beta_1 SPY_{t-1} + \beta_2 SHY_{t-1})\)</span> are the new terms; they are called error correction terms.</p>
<p>The <span class="math inline">\(\beta_0 + \beta_1 SPY_{t-1} + \beta_2 SHY_{t-1}\)</span> term is the long run, or equilibrium relationship of the variables. Suppose we fit this VECM model and get estimates of the <span class="math inline">\(\beta\)</span>s of <span class="math inline">\(\beta_0 = 0.50\)</span>, <span class="math inline">\(\beta_1 = 1\)</span>, <span class="math inline">\(\beta_2 = -1\)</span>. That means we estimated the long run relationship between the two price series to be <span class="math inline">\(0 = 0.50 + SPY_{t-1} - SHY_{t-1}\)</span>, or in other words <span class="math inline">\(SHY_{t-1} = 0.50 + SPY_{t-1}\)</span>.</p>
<p>So if we fit a VECM, the <span class="math inline">\(\beta\)</span>’s tell us the equilibrium relationship that the two series like to maintain. This is a random process, though, so on any given day the series are likely to deviate from this relationship somewhat. How, exactly, will the two series respond so that the relationship gets pushed back in line with its long run equilibrium?</p>
<p>This push back is governed by the <span class="math inline">\(\alpha\)</span>s. Suppose that <span class="math inline">\(SPY\)</span> gets too big relative to <span class="math inline">\(SHY\)</span> so that the long run equilibrium is violated and <span class="math inline">\(0.50 + SPY_{t-1} - SHY_{t-1}&gt;0\)</span>. Then to make the series come back into long run equilibrium, <span class="math inline">\(SPY\)</span> needs to go down relative to <span class="math inline">\(SHY\)</span> and <span class="math inline">\(SHY\)</span> needs to go up relative to <span class="math inline">\(SPY\)</span>. This means the <span class="math inline">\(\alpha\)</span>’s should be such that they push the two prices back together when they drift apart. The magnitude of the <span class="math inline">\(\alpha\)</span>’s govern which one responds more strongly to disequilibrium and are sometimes called speed of adjustment parameters.</p>
<p>It’s at about this point where you have to start appreciating why people tell you to take linear algebra if you want to do econometrics. This is really messy looking and it is hard to really understand what is going on, what the heck those error correction terms are, and how on earth they might be useful.</p>
<p>Rewriting this in matrix form makes it much neater and (I think) aids understanding. If you’ve had linear algebra, make sure you can reproduce this next step; it will help your understanding of the working parts. If you haven’t yet had linear algebra, consider signing up next semester! and try to understand the explanation of what the <span class="math inline">\(\alpha\)</span>’s and <span class="math inline">\(\beta\)</span>’s are.</p>
<p>As an intermediate step, rewrite the error correction terms as a 2X1 vector with the <span class="math inline">\(\alpha\)</span>’s in it times a 1X1 ‘vector’ with the <span class="math inline">\(\beta\)</span>’s and a linear combination of the price levels in it, <span class="math inline">\(\left[ \begin{array} s\alpha_1 \\ \alpha_2 \end{array} \right] \left[ \begin{array} s\beta_0 + \beta_1 SPY_{t-1} + \beta_2 SHY_{t-1} \end{array} \right]\)</span>. The rest of it is just the terms from a VAR written in matrix form too.</p>
<p><span class="math display">\[\begin{align*}
\left[
\begin{array}
  S\Delta SPY_t \\
\Delta SHY_t
\end{array}
\right]

&amp;=

\left[
\begin{array}
  s\gamma^{spy}_0 \\
\gamma^{SHY}_0
\end{array}
\right]

+

\left[
\begin{array}
  s\alpha_1 \\
  \alpha_2
\end{array}
\right]

\left[
\begin{array}
  s\beta_0 + \beta_1 SPY_{t-1} + \beta_2 SHY_{t-1}
\end{array}
\right]



+

\left[
\begin{array}
  s\gamma^{spy}_1  &amp; \gamma^{spy}_2  \\
   \gamma^{SHY}_1  &amp; \gamma^{SHY}_2  \\
  
\end{array}
\right]

\left[
\begin{array}
  s\Delta SPY_{t-1} \\
   \Delta SHY_{t-1}
\end{array}
\right]

+

\left[
\begin{array}
  s \gamma^{spy}_3 &amp; \gamma^{spy}_4 \\
    \gamma^{SHY}_3 &amp; \gamma^{SHY}_4\\
  
\end{array}
\right]

\left[
\begin{array}
  s\Delta SPY_{t-2} \\
   \Delta SHY_{t-2}
\end{array}
\right]

+

\left[
\begin{array}
  s\nu^{spy}_t  \\
  \nu^{SHY}_t
\end{array}
\right]


\end{align*}\]</span></p>
<p>Next, take that 1X1 ‘matrix’ that holds the linear combination of the series and make it a (1X3) times a (3X1) matrix with the <span class="math inline">\(\beta\)</span>’s and the prices, <span class="math inline">\(\left[ \begin{array} s\beta_0 &amp; \beta_1 &amp; \beta_2 \end{array} \right] \left[\begin{array} s1 \\ SPY_{t-1} \\ SHY_{t-1} \end{array} \right]\)</span>.</p>
<p><span class="math display">\[\begin{align}
\left[
\begin{array}
  S\Delta SPY_t \\
\Delta SHY_t
\end{array}
\right]

&amp;=

\left[
\begin{array}
  s\gamma^{spy}_0 \\
\gamma^{SHY}_0
\end{array}
\right]

+

\left[
\begin{array}
  s\alpha_1 \\
  \alpha_2
\end{array}
\right]

\left[
\begin{array}
  s\beta_0 &amp; \beta_1 &amp; \beta_2
\end{array}
\right]

\left[
\begin{array}
  s1  \\
  SPY_{t-1} \\
  SHY_{t-1}
\end{array}
\right]


+

\left[
\begin{array}
  s\gamma^{spy}_1  &amp; \gamma^{spy}_2  \\
   \gamma^{SHY}_1  &amp; \gamma^{SHY}_2  \\
  
\end{array}
\right]

\left[
\begin{array}
  s\Delta SPY_{t-1} \\
   \Delta SHY_{t-1}
\end{array}
\right]

+

\left[
\begin{array}
  s \gamma^{spy}_3 &amp; \gamma^{spy}_4 \\
    \gamma^{SHY}_3 &amp; \gamma^{SHY}_4\\
  
\end{array}
\right]

\left[
\begin{array}
  s\Delta SPY_{t-2} \\
   \Delta SHY_{t-2}
\end{array}
\right]

+

\left[
\begin{array}
  s\nu^{spy}_t  \\
  \nu^{SHY}_t
\end{array}
\right]
\end{align}\]</span></p>
<p>Now, let’s do one more step of matrix algebra to prepare to talk about how we test whether or not this type of relationship exists in the next section. If I multiply the <span class="math inline">\(\alpha\)</span> matrix with the <span class="math inline">\(\beta\)</span> matrix I should get a 2X3 matrix, <span class="math inline">\(\left[ \begin{array}  s\alpha_1 \beta_0 &amp; \alpha_1 \beta_1 &amp; \alpha_1 \beta _2 \\  \alpha_2 \beta_0 &amp; \alpha_2 \beta_1 &amp; \alpha_2 \beta _2 \end{array} \right]\)</span>.</p>
<p><span class="math display">\[\begin{align}
\left[
\begin{array}
  S\Delta SPY_t \\
\Delta SHY_t
\end{array}
\right]

&amp;=

\left[
\begin{array}
  s\gamma^{spy}_0 \\
\gamma^{SHY}_0
\end{array}
\right]

+
\left[
\begin{array}
s\alpha_1 \beta_0 &amp; \alpha_1 \beta_1 &amp; \alpha_1 \beta _2 \\
\alpha_2 \beta_0 &amp; \alpha_2 \beta_1 &amp; \alpha_2 \beta _2
\end{array}
\right]

\left[
\begin{array}
  s1 \\
  SPY_{t-1} \\
   SHY_{t-1}
\end{array}
\right]

+

\left[
\begin{array}
  s\gamma^{spy}_1  &amp; \gamma^{spy}_2  \\
   \gamma^{SHY}_1  &amp; \gamma^{SHY}_2  \\
  
\end{array}
\right]

\left[
\begin{array}
  s\Delta SPY_{t-1} \\
   \Delta SHY_{t-1}
\end{array}
\right]

+

\left[
\begin{array}
  s \gamma^{spy}_3 &amp; \gamma^{spy}_4 \\
    \gamma^{SHY}_3 &amp; \gamma^{SHY}_4\\
  
\end{array}
\right]

\left[
\begin{array}
  s\Delta SPY_{t-2} \\
   \Delta SHY_{t-2}
\end{array}
\right]

+

\left[
\begin{array}
  s\nu^{spy}_t  \\
  \nu^{SHY}_t
\end{array}
\right]
\end{align}\]</span></p>
<p>In the next section we talk about how the Johansen test takes the estimate of the <span class="math inline">\(\left[ \begin{array}  s\alpha_1 \beta_0 &amp; \alpha_1 \beta_1 &amp; \alpha_1 \beta _2 \\  \alpha_2 \beta_0 &amp; \alpha_2 \beta_1 &amp; \alpha_2 \beta _2 \end{array} \right]\)</span> matrix and uses it to determine if there is evidence that the series are cointegrated.</p>
<section id="the-johansen-test-for-cointegration" class="level2">
<h2 class="anchored" data-anchor-id="the-johansen-test-for-cointegration">The Johansen Test for Cointegration</h2>
<p>Alright, so that is a lot of nitty gritty matrix algebra, that I’ve been purposefully trying to avoid in this series of blog posts. But, the payoff is that we can talk about how the statistical test for cointegration works in a way that is analogous to t-tests that are more familiar.</p>
<p>Recall that cointegration is when two or more variables are known to be non-stationary, yet a linear combination of these exist so that the linear combination is stationary. Notice that the error correction term uses SPY and SHY prices in levels. We know that we cannot put non-stationary variables in a linear regression, yet if SPY and SHY are cointegrated these two regression equations will be ok. Why? Because when you multiply the matrix of <span class="math inline">\(\beta\)</span>s times <span class="math inline">\([1 SPY_{t-1} SHY_{t-1}]'\)</span> vector it will be stationary because the regression will find the <span class="math inline">\(\beta\)</span>’s (as long as such a matrix exists) that makes <span class="math inline">\(\beta_0 + \beta_1 SPY_{t-1} + \beta_2 SHY_{t-1}\)</span> stationary.</p>
<p>Now if we don’t know whether or not our variables are cointegrated, we will need a test to determine this. The most common is called the Johansen cointegration test. What the Johansen test does is estimates the VECM and determines if the <span class="math inline">\(\alpha \beta\)</span> matrix is ‘zero’. I put zero in quotes because the analogous concept of zero in numbers is the determinant in matrices. In a typical linear regression, if you are unsure whether you should include a variable on the right hand side you might just run the model and do a t-test to see if the coefficient on that variable is statistically different from zero.</p>
<p>The Johansen cointegration test does something similar. It estimates the VECM model and tests whether or not the determinant of the <span class="math inline">\(\alpha \beta\)</span> matrix is zero. If it is not zero, then you have cointegration (probably - I’ll explain more in a bit).</p>
</section>
<section id="apply-the-johansen-test" class="level2">
<h2 class="anchored" data-anchor-id="apply-the-johansen-test">Apply the Johansen Test</h2>
<p>I think its really easiest to understand what the previous discussion means by looking at some actual output from a Johansen test.</p>
<div class="cell" data-hash="2018-02-05-Basic-Time-Series-Analysis-VECM_cache/html/unnamed-chunk-3_35bdccdfcb9d103de620754a9a90bca3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(urca)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>johansentest <span class="ot">&lt;-</span> <span class="fu">ca.jo</span>(time_series, <span class="at">type =</span> <span class="st">"trace"</span>, <span class="at">ecdet =</span> <span class="st">"const"</span>, <span class="at">K =</span> <span class="dv">3</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(johansentest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
###################### 
# Johansen-Procedure # 
###################### 

Test type: trace statistic , without linear trend and constant in cointegration 

Eigenvalues (lambda):
[1] 1.071108e-02 2.535654e-03 3.938729e-18

Values of teststatistic and critical values of test:

          test 10pct  5pct  1pct
r &lt;= 1 | 10.32  7.52  9.24 12.97
r = 0  | 54.08 17.85 19.96 24.60

Eigenvectors, normalised to first column:
(These are the cointegration relations)

             SPY.l3    SHY.l3  constant
SPY.l3       1.0000    1.0000   1.00000
SHY.l3     115.3853  -32.1019 -12.04965
constant -9711.8640 2233.5646 777.66905

Weights W:
(This is the loading matrix)

             SPY.l3        SHY.l3     constant
SPY.d  7.699219e-06 -1.271609e-03 2.839169e-18
SHY.d -8.297597e-06  3.024787e-06 5.484280e-19</code></pre>
</div>
</div>
<p>Above is the output from the Johansen trace test for cointegration. There is also a similar test called the eigen test, which I won’t cover in this post, but you interpret them the same way. They usually give the same conclusion, but not always.</p>
<p>Focus on the output that has <span class="math inline">\(r &lt;= 1\)</span> and <span class="math inline">\(r &lt;= 0\)</span>. These are the results from the actual Johansen test. The <span class="math inline">\(r = 0\)</span> line is testing the hypothesis that the rank of the matrix equals zero (think testing if the matrix is ‘=’ zero, i.e., the error correction term doesn’t belong). Notice that the test statistic, 71.46, is quite a bit above the one percent critical value of 24.60. Hence we should reject the null hypothesis.</p>
<p>Next we consider the hypothesis that <span class="math inline">\(r &lt;= 1\)</span>, (which now that we have rejected <span class="math inline">\(r = 0\)</span>, the test is for <span class="math inline">\(r = 1\)</span> since rank of a matrix is an integer). In this case, the test statistic is 8.19, which is less than all but the 10% critical values. Hence we fail to reject the null hypothesis and conclude the rank = 1.</p>
<p>This means that there is indeed one cointegrating relationship, and the VECM is appropriate.</p>
<p>What if we had rejected the <span class="math inline">\(r = 1\)</span> hypothesis? Then we would have to conclude the rank = 2. This would indicate the series are stationary after all.</p>
</section>
<section id="fit-the-vecm" class="level2">
<h2 class="anchored" data-anchor-id="fit-the-vecm">Fit the VECM</h2>
<p>The fitted VECM is actually delivered from the call to <code>ca.jo</code>, but it is put into a bit more intuitive form by passing the <code>johansentest</code> object to the <code>cajorls()</code> function.</p>
<div class="cell" data-hash="2018-02-05-Basic-Time-Series-Analysis-VECM_cache/html/unnamed-chunk-4_cb9947cb6c18f524bb21119cdfcd4fba">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">cajorls</span>(johansentest, <span class="at">r =</span> <span class="dv">1</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>t</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$rlm

Call:
lm(formula = substitute(form1), data = data.mat)

Coefficients:
         SPY.d       SHY.d     
ect1      7.699e-06  -8.298e-06
SPY.dl1  -8.251e-02   5.513e-04
SHY.dl1   1.869e+00  -7.247e-02
SPY.dl2   2.974e-02  -5.027e-04
SHY.dl2   3.700e-01  -5.681e-02


$beta
               ect1
SPY.l3       1.0000
SHY.l3     115.3853
constant -9711.8640</code></pre>
</div>
</div>
<p>In the ‘Coefficients’ output, the <span class="math inline">\(\alpha\)</span>’s and <span class="math inline">\(\gamma\)</span>’s are given. Specifically, <span class="math inline">\(\alpha_1\)</span>, the coeficient on the error correction term in the SPY equation, is 1.319e-06, and <span class="math inline">\(\alpha_2\)</span> is 9.070e-06. The remaining are the <span class="math inline">\(\gamma\)</span>’s, the coefficients on the lagged return variables.</p>
<p>The ‘<span class="math inline">\(\beta\)</span>’ output gives the error correction term. Here we have that <span class="math inline">\(\beta_0\)</span> is 16200.3089, <span class="math inline">\(\beta_1\)</span> is 1, and <span class="math inline">\(\beta_2\)</span> is -193.8095.</p>
<p>Notice that information is also present in the previous output. The <span class="math inline">\(\alpha\)</span>’s are the first column of the ‘loading matrix’, and the <span class="math inline">\(\beta\)</span>’s are the first column of the eigenvectors matrix.</p>
</section>
<section id="what-does-this-tell-you" class="level2">
<h2 class="anchored" data-anchor-id="what-does-this-tell-you">What does this tell you?</h2>
<p>In my opinion, this model provides more opportunity for ‘economic analysis’ than the previous models we covered in this series. The <span class="math inline">\(\beta\)</span>’s tell you what the long run equilibrium among the series looks like, which should be influenced by various economic factors. For example, in <a href="">this</a> paper my coauthors and I showed that a VECM model on one year deferred corn, ethanol, and natural gas prices produces an error correction term that looks an awful lot like what you would get if you calculate a no-profit condition in the ethanol industry.</p>
<p>Finally, as we mentioned before, the <span class="math inline">\(\alpha\)</span>’s tell you how fast the series tend to move back together when they get out of whack, which speaks to the nature of frictions in the markets that might allow departures from long-run equilibrium.</p>
</section>
<section id="granger-causality-on-cointegrated-series" class="level2">
<h2 class="anchored" data-anchor-id="granger-causality-on-cointegrated-series">Granger Causality on Cointegrated Series</h2>
<p>You can also do Granger causality analysis on cointegrated series, but be warned you should take care in how you execute it. See Dave Giles’ excellent <a href="http://davegiles.blogspot.com/2011/10/var-or-vecm-when-testing-for-granger.html">post</a> about it, and <a href="https://datazen.info/toda-yamamoto-implementation-in-r/">this</a> post of how to implement the test in R.</p>
</section>
</section>
<section id="thats-it" class="level1">
<h1>That’s It!</h1>
<p>That covers the basics of what a VECM model is and how to analyze how a group of markets move around an equilibrium relationship.</p>
<p>The final post in this series will summarize the series and provide a ‘cook-book’ like decision tree on how to decide which model is appropriate for your case.</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p>Murray, M. P. (1994). A drunk and her dog: an illustration of cointegration and error correction. <em>The American Statistician</em>, 48(1), 37-39.</p>
<p>Johansen, S. (1991) Estimation and Hypothesis Testing of Cointegration Vectors in Gaussian Vector Autoregressive Models, <em>Econometrica</em> 59 (6): 1551-1580.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>I linked the actual journal article, which is gated, but if you Google the title you can find the pdf openly available.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>